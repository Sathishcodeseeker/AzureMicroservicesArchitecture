Connecting AKS, Azure Entra ID, and Azure APIM

Complete Architecture Guide for Advanced Learning

Step 1: High-Level Architecture Overview

ğŸ¯ Integration Architecture

EXTERNAL CLIENTS
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Web Apps  â”‚  Mobile  â”‚   SPAs   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                            HTTPS + OAuth 2.0
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      AZURE ENTRA ID              â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ â€¢ App Registrations        â”‚  â”‚
                    â”‚  â”‚ â€¢ Managed Identities       â”‚  â”‚
                    â”‚  â”‚ â€¢ Token Issuance           â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                            JWT Access Token
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AZURE API MANAGEMENT           â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ â€¢ JWT Validation           â”‚  â”‚
                    â”‚  â”‚ â€¢ Rate Limiting            â”‚  â”‚
                    â”‚  â”‚ â€¢ Request Transform        â”‚  â”‚
                    â”‚  â”‚ â€¢ Security Policies        â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                        Private Link / VNet
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AZURE KUBERNETES SERVICE        â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ Ingress Controller         â”‚  â”‚
                    â”‚  â”‚ â€¢ NGINX / App Gateway      â”‚  â”‚
                    â”‚  â”‚ â€¢ TLS Termination          â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ Application Pods           â”‚  â”‚
                    â”‚  â”‚ â€¢ Business Logic           â”‚  â”‚
                    â”‚  â”‚ â€¢ JWT Validation           â”‚  â”‚
                    â”‚  â”‚ â€¢ Workload Identity        â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                          Managed Identity
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                          â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚   Key   â”‚              â”‚   Storage   â”‚          â”‚  Azure SQL  â”‚
   â”‚  Vault  â”‚              â”‚   Account   â”‚          â”‚  Database   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    2. Authentication Flow (Numbered Steps):

    STEP 1: User Initiates Login
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚  Redirect to login page              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
                                                   â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  Azure Entra ID â”‚
                                        â”‚  Login Page     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: User Authenticates
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  Azure Entra ID â”‚
                                        â”‚  â€¢ Username/Pwd â”‚
                                        â”‚  â€¢ MFA (if req) â”‚
                                        â”‚  â€¢ Consent      â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: Authorization Code Returned
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Azure Entra ID â”‚
â”‚   App    â”‚  Redirect with auth code   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: Exchange Code for Tokens
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Azure Entra ID â”‚
â”‚   App    â”‚  POST /token               â”‚  Returns:       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  + auth code                â”‚  â€¢ Access Token â”‚
              + client_id                â”‚  â€¢ Refresh Tokenâ”‚
              + client_secret            â”‚  â€¢ ID Token     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 5: API Request with Access Token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     APIM        â”‚
â”‚   App    â”‚  GET /api/resource         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Authorization: Bearer xyz  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 6: APIM Validates Token
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚      APIM       â”‚
                                        â”‚  âœ“ Signature    â”‚
                                        â”‚  âœ“ Expiration   â”‚
                                        â”‚  âœ“ Audience     â”‚
                                        â”‚  âœ“ Issuer       â”‚
                                        â”‚  âœ“ Scopes       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 7: APIM Forwards Request to AKS
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚      APIM       â”‚
                                        â”‚  + X-User-Id    â”‚
                                        â”‚  + X-User-Email â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       AKS       â”‚
                                        â”‚    Ingress      â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 8: AKS Processes Request
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       AKS       â”‚
                                        â”‚  Application    â”‚
                                        â”‚  â€¢ Validate JWT â”‚
                                        â”‚  â€¢ Authorize    â”‚
                                        â”‚  â€¢ Execute      â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 9: AKS Accesses Azure Resources (if needed)
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       AKS       â”‚
                                        â”‚  Workload ID    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€
                                                 â”‚
                                                 â”‚ Managed Identity
                                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                            â”‚                â”‚
                    â–¼                            â–¼                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Key Vault   â”‚           â”‚   Storage    â”‚  â”‚  Azure SQL   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 10: Response Returned to Client
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      APIM       â”‚
â”‚   App    â”‚  200 OK + Response Data    â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       AKS       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ—ï¸ Architecture Layers Breakdown:

Layer 1: Presentation Layer:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PRESENTATION LAYER                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Web Apps    â”‚   â”‚ Mobile Apps  â”‚   â”‚    SPAs      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ React      â”‚   â”‚ â€¢ iOS        â”‚   â”‚ â€¢ Angular    â”‚  â”‚
â”‚  â”‚ â€¢ Vue.js     â”‚   â”‚ â€¢ Android    â”‚   â”‚ â€¢ Vue        â”‚  â”‚
â”‚  â”‚ â€¢ Blazor     â”‚   â”‚ â€¢ React Nat. â”‚   â”‚ â€¢ Svelte     â”‚  â”‚
â”‚  â”‚ â€¢ ASP.NET    â”‚   â”‚ â€¢ Flutter    â”‚   â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  Authentication: OAuth 2.0 Authorization Code Flow       â”‚
â”‚  Token Storage: HttpOnly Cookies / Secure Storage        â”‚
â”‚                                                          |
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 2: Identity & Access Management:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”
â”‚          IDENTITY & ACCESS MANAGEMENT LAYER                 â”‚
â”‚                  (Azure Entra ID)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  APP REGISTRATIONS                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Registration 1: Client Application                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Client ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Redirect URIs: https://app.example.com/callback  â”‚   â”‚
â”‚  â”‚  â”œâ”€ API Permissions:                                 â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Backend API (user_impersonation)              â”‚   â”‚
â”‚  â”‚  â””â”€ Token Configuration: Optional claims             â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Registration 2: Backend API                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ Client ID: yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy  â”‚   â”‚
â”‚  â”‚  â”œâ”€ App ID URI: api://backend-api                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ Exposed Scopes:                                  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ user_impersonation                            â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ read                                          â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ write                                         â”‚   â”‚
â”‚  â”‚  â””â”€ App Roles:                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Admin                                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ User                                          â”‚   â”‚
â”‚  â”‚     â””â”€ ReadOnly                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MANAGED IDENTITIES                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  System-Assigned Identity                            â”‚   â”‚
â”‚  â”‚  â””â”€ AKS Cluster Identity                             â”‚   â”‚
â”‚  â”‚     â””â”€ Used for: Node operations, ACR pull           â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚  
â”‚  â”‚  User-Assigned Identities                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ Workload Identity 1: backend-api-identity        â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Federated with: K8s SA backend-api-sa         â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Access to: Key Vault, Storage                 â”‚   â”‚
â”‚  â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  â””â”€ Workload Identity 2: frontend-identity           â”‚   â”‚
â”‚  â”‚     â””â”€ Federated with: K8s SA frontend-sa            â”‚   â”‚
â”‚  â”‚     â””â”€ Access to: Storage only                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  TOKEN CONFIGURATION                                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Access Token Lifetime: 60 minutes                 â”‚   â”‚
â”‚  â”‚  â€¢ Refresh Token Lifetime: 90 days                   â”‚   â”‚
â”‚  â”‚  â€¢ Token Version: v2.0                               â”‚   â”‚
â”‚  â”‚  â€¢ Signing Algorithm: RS256                          â”‚   â”‚
â”‚  â”‚  â€¢ Optional Claims:                                  â”‚   â”‚
â”‚  â”‚    â”œâ”€ email                                          â”‚   â”‚
â”‚  â”‚    â”œâ”€ groups                                         â”‚   â”‚
â”‚  â”‚    â”œâ”€ preferred_username                             â”‚   â”‚
â”‚  â”‚    â””â”€ roles                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”˜

Layer 3: API Gateway:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY LAYER                        â”‚
â”‚               (Azure API Management)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Public Endpoint: https://myapim.azure-api.net             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  INBOUND POLICIES (Execution Order)                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [1] validate-jwt                                    â”‚ â”‚
â”‚  â”‚      â”œâ”€ Validate signature (RS256)                   â”‚ â”‚
â”‚  â”‚      â”œâ”€ Check audience: api://backend-api            â”‚ â”‚
â”‚  â”‚      â”œâ”€ Check issuer: https://sts.windows.net/...    â”‚ â”‚
â”‚  â”‚      â”œâ”€ Verify expiration time                       â”‚ â”‚
â”‚  â”‚      â”œâ”€ Validate required scopes                     â”‚ â”‚
â”‚  â”‚      â””â”€ OpenID config: /.well-known/openid-config   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [2] rate-limit-by-key                               â”‚ â”‚
â”‚  â”‚      â”œâ”€ Calls: 100 per minute                        â”‚ â”‚
â”‚  â”‚      â”œâ”€ Counter key: IP Address                      â”‚ â”‚
â”‚  â”‚      â””â”€ Renewal period: 60 seconds                   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [3] quota-by-key                                    â”‚ â”‚
â”‚  â”‚      â”œâ”€ Calls: 10,000 per day                        â”‚ â”‚
â”‚  â”‚      â”œâ”€ Bandwidth: 100 MB per day                    â”‚ â”‚
â”‚  â”‚      â””â”€ Counter key: Subscription ID                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [4] ip-filter                                       â”‚ â”‚
â”‚  â”‚      â”œâ”€ Action: Allow                                â”‚ â”‚
â”‚  â”‚      â”œâ”€ Allowed IPs: Corporate network range         â”‚ â”‚
â”‚  â”‚      â””â”€ Blocked IPs: Known malicious IPs             â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [5] set-header (Forward claims)                     â”‚ â”‚
â”‚  â”‚      â”œâ”€ X-User-Id: Extract from JWT 'oid' claim      â”‚ â”‚
â”‚  â”‚      â”œâ”€ X-User-Email: Extract from JWT 'email'       â”‚ â”‚
â”‚  â”‚      â”œâ”€ X-User-Roles: Extract from JWT 'roles'       â”‚ â”‚
â”‚  â”‚      â””â”€ X-Correlation-Id: Generate unique ID         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [6] cors (Optional)                                 â”‚ â”‚
â”‚  â”‚      â”œâ”€ Allowed origins: https://app.example.com     â”‚ â”‚
â”‚  â”‚      â”œâ”€ Allowed methods: GET, POST, PUT, DELETE      â”‚ â”‚
â”‚  â”‚      â”œâ”€ Allowed headers: Authorization, Content-Type â”‚ â”‚
â”‚  â”‚      â””â”€ Allow credentials: true                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BACKEND CONFIGURATION                               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Option 1: Internal Load Balancer                    â”‚ â”‚
â”‚  â”‚  â””â”€ URL: http://10.0.1.100/api                       â”‚ â”‚
â”‚  â”‚     â””â”€ Use case: Direct AKS service access           â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Option 2: Private Ingress with DNS                  â”‚ â”‚
â”‚  â”‚  â””â”€ URL: https://api.aks.internal.company.com        â”‚ â”‚
â”‚  â”‚     â””â”€ Use case: TLS + custom domain                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Option 3: Private Endpoint                          â”‚ â”‚
â”‚  â”‚  â””â”€ URL: https://aks-pe.privatelink.azure.com        â”‚ â”‚
â”‚  â”‚     â””â”€ Use case: Maximum security isolation          â”‚ â”‚
â”‚  â”‚   â”‚  â”‚  â”œâ”€ Baseline: Enforced (all namespaces)              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Restricted: Enforced (production namespace)      â”‚ â”‚
â”‚  â”‚  â””â”€ Privileged: Audit only (system namespaces)       â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Pod Security Policies (Deprecated - use PSS):       â”‚ â”‚
â”‚  â”‚  â”œâ”€ No privileged containers                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ No host network/PID/IPC                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Read-only root filesystem                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Run as non-root user                             â”‚ â”‚
â”‚  â”‚  â””â”€ Drop all capabilities except NET_BIND_SERVICE    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MONITORING & OBSERVABILITY                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Azure Monitor Container Insights                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Metrics: CPU, Memory, Network, Disk              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Logs: Container logs, K8s events                 â”‚ â”‚
â”‚  â”‚  â””â”€ Alerts: Resource thresholds, pod failures        â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Application Insights                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Distributed tracing                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Request/dependency tracking                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Custom metrics & events                          â”‚ â”‚
â”‚  â”‚  â””â”€ Live metrics stream                              â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Prometheus & Grafana (Optional)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Prometheus: Metrics collection                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Grafana: Visualization dashboards                â”‚ â”‚
â”‚  â”‚  â””â”€ AlertManager: Alert routing                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Layer 5: Data & Services:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                DATA & SERVICES LAYER                        â”‚
â”‚                  (Azure Services)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AZURE KEY VAULT                                     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Name: my-keyvault                                   â”‚ â”‚
â”‚  â”‚  SKU: Premium (HSM-backed)                           â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Secrets:                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ database-connection-string                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ api-key-third-party                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ storage-account-key                              â”‚ â”‚
â”‚  â”‚  â””â”€ smtp-password                                    â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Certificates:                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ wildcard-tls-cert (*.aks.company.com)           â”‚ â”‚
â”‚  â”‚  â”œâ”€ client-certificate (mTLS)                        â”‚ â”‚
â”‚  â”‚  â””â”€ signing-certificate                              â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Keys:                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ encryption-key (RSA 4096)                        â”‚ â”‚
â”‚  â”‚  â””â”€ signing-key (EC P-384)                           â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Access Policies:                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Managed Identity: backend-api-identity           â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Permissions: Get Secrets, Get Certificates    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Managed Identity: frontend-identity              â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Permissions: Get Secrets                      â”‚ â”‚
â”‚  â”‚  â””â”€ User: admin@company.com                          â”‚ â”‚
â”‚  â”‚     â””â”€ Permissions: All (management)                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Network:                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Public access: Disabled                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Private endpoint: Enabled                        â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Connected to: AKS VNet                        â”‚ â”‚
â”‚  â”‚  â””â”€ Firewall: Allow Azure services                   â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Security:                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Soft delete: Enabled (90 days)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Purge protection: Enabled                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ RBAC: Azure role-based access control            â”‚ â”‚
â”‚  â”‚  â””â”€ Logging: Diagnostic logs to Log Analytics        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AZURE STORAGE ACCOUNT                               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Name: mystorageaccount                              â”‚ â”‚
â”‚  â”‚  SKU: Standard_ZRS (Zone-redundant)                  â”‚ â”‚
â”‚  â”‚  Kind: StorageV2                                     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Blob Containers:                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ uploads (Public access: None)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ documents (Public access: None)                  â”‚ â”‚
â”‚  â”‚  â””â”€ backups (Public access: None)                    â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  File Shares:                                        â”‚ â”‚
â”‚  â”‚  â””â”€ shared-data (Protocol: SMB 3.0)                  â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Access Control:                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Managed Identity: backend-api-identity           â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Role: Storage Blob Data Contributor           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Managed Identity: frontend-identity              â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Role: Storage Blob Data Reader                â”‚ â”‚
â”‚  â”‚  â””â”€ Shared Access Signature: Disabled                â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Network:                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Public access: Disabled                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Private endpoint: Enabled                        â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Blob endpoint                                 â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ File endpoint                                 â”‚ â”‚
â”‚  â”‚  â””â”€ Firewall: Allow from AKS subnet                  â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Security:                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Encryption: Microsoft-managed keys               â”‚ â”‚
â”‚  â”‚  â”œâ”€ TLS version: 1.2 minimum                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Blob versioning: Enabled                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Soft delete: 30 days                             â”‚ â”‚
â”‚  â”‚  â””â”€ Immutable storage: Enabled (compliance)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AZURE SQL DATABASE                                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Server: mysqlserver.database.windows.net            â”‚ â”‚
â”‚  â”‚  Database: production-db                             â”‚ â”‚
â”‚  â”‚  Tier: General Purpose (vCore)                       â”‚ â”‚
â”‚  â”‚  Compute: 4 vCores, 20 GB memory                     â”‚ â”‚
â”‚  â”‚  Storage: 256 GB (auto-grow enabled)                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Authentication:                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Entra ID authentication: Enabled                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Entra ID admin: DBA-Group                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ SQL authentication: Disabled                     â”‚ â”‚
â”‚  â”‚  â””â”€ Managed Identity access:                         â”‚ â”‚
â”‚  â”‚     â””â”€ backend-api-identity                          â”‚ â”‚
â”‚  â”‚        â””â”€ Role: db_datareader, db_datawriter         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Connection from AKS:                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Connection string (from Key Vault):              â”‚ â”‚
â”‚  â”‚  â”‚  Server=mysqlserver.database.windows.net;         â”‚ â”‚
â”‚  â”‚  â”‚  Database=production-db;                          â”‚ â”‚
â”‚  â”‚  â”‚  Authentication=Active Directory Managed Identity â”‚ â”‚
â”‚  â”‚  â””â”€ Driver: Microsoft.Data.SqlClient                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Network:                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Public access: Disabled                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Private endpoint: Enabled                        â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Connected to: AKS VNet                        â”‚ â”‚
â”‚  â”‚  â””â”€ Firewall: No public IPs allowed                  â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Security:                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ TDE (Transparent Data Encryption): Enabled       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Advanced Threat Protection: Enabled              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Vulnerability Assessment: Enabled                â”‚ â”‚
â”‚  â”‚  â”œâ”€ Auditing: Enabled (to Log Analytics)             â”‚ â”‚
â”‚  â”‚  â”œâ”€ Backup retention: 35 days                        â”‚ â”‚
â”‚  â”‚  â””â”€ Geo-replication: Enabled (secondary region)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AZURE CONTAINER REGISTRY (ACR)                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Name: myacr.azurecr.io                              â”‚ â”‚
â”‚  â”‚  SKU: Premium                                        â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Repositories:                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ backend-api (tags: v1.0, v1.1, latest)          â”‚ â”‚
â”‚  â”‚  â”œâ”€ frontend-app (tags: v2.0, latest)               â”‚ â”‚
â”‚  â”‚  â””â”€ worker-service (tags: v1.0, latest)             â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Access:                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ AKS Kubelet Identity: AcrPull role               â”‚ â”‚
â”‚  â”‚  â”œâ”€ CI/CD Pipeline: AcrPush role                     â”‚ â”‚
â”‚  â”‚  â””â”€ Admin account: Disabled                          â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Network:                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ Public access: Disabled                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ Private endpoint: Enabled                        â”‚ â”‚
â”‚  â”‚  â””â”€ Trusted services: Azure services allowed         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Security:                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Content trust: Enabled (image signing)           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Vulnerability scanning: Microsoft Defender       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Quarantine: Enabled                              â”‚ â”‚
â”‚  â”‚  â””â”€ Retention policy: Keep last 10 tags              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ Security Architecture (Defense in Depth)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURITY LAYERS (Defense in Depth)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Network Security                                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Network Security Groups (NSGs)                    â”‚  â”‚
â”‚  â”‚ â€¢ Azure Firewall / Application Gateway              â”‚  â”‚
â”‚  â”‚ â€¢ Private Link / Private Endpoints                  â”‚  â”‚
â”‚  â”‚ â€¢ VNet Integration & Peering                        â”‚  â”‚
â”‚  â”‚ â€¢ DDoS Protection Standard                          â”‚  â”‚
â”‚  â”‚ â€¢ Web Application Firewall (WAF)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 2: Identity & Access Management                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Azure Entra ID Authentication                     â”‚  â”‚
â”‚  â”‚ â€¢ OAuth 2.0 / OpenID Connect                        â”‚  â”‚
â”‚  â”‚ â€¢ Multi-Factor Authentication (MFA)                 â”‚  â”‚
â”‚  â”‚ â€¢ Conditional Access Policies                       â”‚  â”‚
â”‚  â”‚ â€¢ Managed Identities (no credentials in code)       â”‚  â”‚
â”‚  â”‚ â€¢ Privileged Identity Management (PIM)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 3: API Gateway Security                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ JWT Token Validation                              â”‚  â”‚
â”‚  â”‚ â€¢ Subscription Key Management                       â”‚  â”‚
â”‚  â”‚ â€¢ Rate Limiting & Throttling                        â”‚  â”‚
â”‚  â”‚ â€¢ IP Filtering & Geo-filtering                      â”‚  â”‚
â”‚  â”‚ â€¢ Request/Response Validation                       â”‚  â”‚
â”‚  â”‚ â€¢ CORS Policy Enforcement                           â”‚  â”‚
â”‚  â”‚ â€¢ API Versioning & Deprecation                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 4: Application Security                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ JWT Validation in Application                     â”‚  â”‚
â”‚  â”‚ â€¢ Role-Based Access Control (RBAC)                  â”‚  â”‚
â”‚  â”‚ â€¢ Input Validation & Sanitization                   â”‚  â”‚
â”‚  â”‚ â€¢ Output Encoding                                   â”‚  â”‚
â”‚  â”‚ â€¢ Secure Coding Practices                           â”‚  â”‚
â”‚  â”‚ â€¢ Dependency Vulnerability Scanning                 â”‚  â”‚
â”‚  â”‚ â€¢ Container Image Scanning                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 5: Platform Security (Kubernetes)                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Pod Security Standards                            â”‚  â”‚
â”‚  â”‚ â€¢ Network Policies                                  â”‚  â”‚
â”‚  â”‚ â€¢ RBAC for Kubernetes                               â”‚  â”‚
â”‚  â”‚ â€¢ Secrets Management (CSI driver)                   â”‚  â”‚
â”‚  â”‚ â€¢ Service Mesh (optional - Istio/Linkerd)           â”‚  â”‚
â”‚  â”‚ â€¢ Admission Controllers (OPA Gatekeeper)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 6: Data Security                                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Encryption at Rest (Azure Storage, SQL TDE)       â”‚  â”‚
â”‚  â”‚ â€¢ Encryption in Transit (TLS 1.2+)                  â”‚  â”‚
â”‚  â”‚ â€¢ Key Management (Key Vault)                        â”‚  â”‚
â”‚  â”‚ â€¢ Data Classification & Labeling                    â”‚  â”‚
â”‚  â”‚ â€¢ Backup & Disaster Recovery                        â”‚  â”‚
â”‚  â”‚ â€¢ Data Retention Policies                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  Layer 7: Monitoring & Compliance                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Azure Monitor & Log Analytics                     â”‚  â”‚
â”‚  â”‚ â€¢ Microsoft Defender for Cloud                      â”‚  â”‚
â”‚  â”‚ â€¢ Security Information and Event Management (SIEM)  â”‚  â”‚
â”‚  â”‚ â€¢ Audit Logging                                     â”‚  â”‚
â”‚  â”‚ â€¢ Compliance Reporting (SOC 2, ISO 27001, etc.)     â”‚  â”‚
â”‚  â”‚ â€¢ Threat Detection & Response                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


